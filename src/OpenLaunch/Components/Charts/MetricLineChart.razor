@using ApexCharts
@rendermode InteractiveServer

<ApexChart TItem="MetricResult" Title="@Title" Height="300">
    @if (SeriesData != null)
    {
    @foreach (var series in SeriesData)
    {
    <ApexPointSeries TItem="MetricResult"
                     Items="series.Value"
                     Name="@FriendlyNames[series.Key]"
                     SeriesType="SeriesType.Line"
                     XValue="@(e => e.Timestamp.ToString("MMM dd"))"
                     YValue="@(e => e.Value)" />
    }
    }
    else
    {
    <text>Loading data...</text>
    }
</ApexChart>

@code {
    [Parameter]
    public string Title { get; set; }

    [Parameter]
    public Dictionary<string, List<MetricResult>> SeriesData { get; set; }
    
    public Dictionary<string, string> FriendlyNames { get; set; } = new()
    {
        { "send_1", "Sent" },
        { "opens_3", "Opened" },
        { "delivery_2", "Delivered" },
        { "clicks_4", "Clicked" },
        { "transientBounce_5", "Transient Bounce" },
        { "permanentBounce_6", "Permanent Bounce" },
        { "complaints_7", "Complaints" }
    };

    public class MetricResult
    {
        public DateTime Timestamp { get; set; }
        public long Value { get; set; }
    }
    
    protected override void OnParametersSet()
    {
        Console.WriteLine($"MetricLineChart received {SeriesData?.Count} series");
        base.OnParametersSet();
    }
}